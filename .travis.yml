language: php
php:
- 5.4
- 5.5
- 5.6

env:
    - INFLUXDB_VERSION="0.9.0-rc10_amd64" PHPUNIT_GROUP="0.9"
    - INFLUXDB_VERSION="0.8.8_amd64" PHPUNIT_GROUP="0.8"

before_install:
- sudo apt-get update
- sudo apt-get install libcurl4-openssl-dev libjson0-dev
- wget http://get.influxdb.org/influxdb_$INFLUXDB_VERSION.deb
- sudo useradd influxdb
- sudo dpkg -i influxdb_$INFLUXDB_VERSION.deb
- sudo mkdir -p /opt/influxdb/shared
- sudo cp ./scripts/influxdb_conf.toml /opt/influxdb/shared/config.toml
- travis_retry sudo service influxdb restart
- sudo service influxdb status

before_script:
- composer selfupdate
- composer install --prefer-source

script:
- vendor/bin/phpspec run -n
- vendor/bin/phpunit --group $PHPUNIT_GROUP

notifications:
  slack:
    secure: UN4V33CfLzEcb+5/LWcfcbwROZobbUawgFSiM3TzagBC+7w0DH2rK8DczxkUBs5rNAaYBj+DkxmmF9tiDb0BLB7Jezlq0vmrNBOhregLodOG44/bFwg58YOwTGxt/Iak38A+8VskGj0sSybNq4TB1/K0040wXS5bA+M/9NqyQeo=
